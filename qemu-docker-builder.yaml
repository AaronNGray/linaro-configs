- job:
    name: qemu-docker-builder
    project-type: freestyle
    defaults: global
    logrotate:
        daysToKeep: 30
        numToKeep: 30
    properties:
        - authorization:
            anonymous:
                - job-read
                - job-extended-read
            linaro:
                - job-read
                - job-extended-read
                - job-build
                - job-cancel
    parameters:
        - string:
            name: source
            description: 'dsc source url or filename'
        - string:
            name: arch
            description: 'architecture to build for: amd64, i386, armhf, arm64'
    disabled: false
    node: docker-utopic
    display-name: 'QEMU package build'
    wrappers:
        - timestamps
    builders:
        - shell: |
            #!/bin/bash

            set -e

            rm -rf ubuntu-packaging-tools
            git clone --depth 1 http://git.linaro.org/ci/ubuntu-packaging-tools.git
            ./ubuntu-packaging-tools/dockerbuild
    publishers:
        - copy-to-master:
            includes:
                - '*.changes, *.dsc, *.gz, *.bz2, *.xz, *.deb, *.udeb'
        - trigger-parameterized-builds:
            - project: post-build-repo
              property-file: post_build_ppa_parameters
              condition: SUCCESS
        - email:
            recipients: 'riku.voipio@linaro.org'
