- job:
    name: qemu-docker-builder
    project-type: freestyle
    defaults: global
    logrotate:
        daysToKeep: 30
        numToKeep: 30
    properties:
        - authorization:
            anonymous:
                - job-read
                - job-extended-read
            riku.voipio@linaro.org:
                - job-read
                - job-extended-read
                - job-configure
                - job-build
                 
    disabled: false
    node: docker
    display-name: 'Qemu package builds'

    parameters:
        - string:
            name: source
            description: 'The dsc source url or filename'
        - string:
            name: arch
            description: 'architecture to build for - amd64, i386, armhf, arm64'
            defaultvalue: armhf

    builders:
        - shell: |
            #!/bin/sh
            set -e
            rm -rf ubuntu-packaging-tools
            git clone http://git.linaro.org/ci/ubuntu-packaging-tools.git
            ./ubuntu-packaging-tools/dockerbuild

    publishers:
        - copy-to-master:
            includes: 
                - '*.changes, *.dsc, *.gz, *.bz2, *.xz, *.deb, *.udeb'
        - email:
            recipients: riku.voipio@linaro.org
        - trigger-parameterized-builds:
            - project: post-build-repo
              property-file: post_build_ppa_parameters
              condition: SUCCESS
